name: Build APK

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: 'gradle'
    
    - name: Validate Gradle wrapper
      uses: gradle/wrapper-validation-action@v2
      continue-on-error: true
    
    - name: Make gradlew executable
      run: chmod +x gradlew
    
    - name: Setup Gradle
      uses: gradle/gradle-build-action@v3
      with:
        gradle-version: 8.2
    
    - name: Build with Gradle
      run: gradle assembleDebug --no-daemon --stacktrace
      
    - name: Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: aidukan-app-debug
        path: app/build/outputs/apk/debug/app-debug.apk
        if-no-files-found: error
        
    - name: Create GitHub Release
      if: success()
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: Aidukan App v1.0.${{ github.run_number }}
        files: app/build/outputs/apk/debug/app-debug.apk
        body: |
          ## ðŸŽ‰ Aidukan Android App - WORKING VERSION!
          
          **Voice Assistant for Kirana Stores**
          
          ### ðŸ“¥ Installation Instructions:
          1. Download `app-debug.apk` below
          2. Transfer to your Android phone (via USB, WhatsApp, or cloud)
          3. Open the APK file on your phone
          4. Allow installation from unknown sources if prompted
          5. Install and launch the app!
          
          ### âœ¨ Features:
          - Simple, clean interface
          - Ready to use immediately
          - Built with Kotlin & AndroidX
          
          **Build #${{ github.run_number }}** | Built on: ${{ github.event.head_commit.timestamp }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
